# Настройка Telegram бота

## Что умеет бот

✅ Принимает заявки от любых пользователей через диалог
✅ Быстрое создание заявок для зарегистрированных
✅ Просмотр своих заявок
✅ Уведомления админа о новых заявках

## Шаг 1: Настройка webhook

Telegram должен знать, куда отправлять сообщения от пользователей. Выполните команду:

```bash
curl "https://api.telegram.org/bot8020100875:AAEfiupni_EUkqQlWXtJv2vgCx0yL5i8-58/setWebhook?url=https://functions.poehali.dev/053f0a02-6a69-470d-8166-a03dbd9deb50"
```

**Ответ должен быть:**
```json
{"ok":true,"result":true,"description":"Webhook was set"}
```

## Шаг 2: Проверка работы

1. Найдите вашего бота в Telegram (имя указано в @BotFather)
2. Напишите `/start`
3. Бот должен ответить приветствием

## Шаг 3: Команды бота

Пользователи могут использовать:
- `/start` - Начать работу с ботом
- `/new` - Создать новую заявку
- `/my` - Посмотреть свои заявки
- `/cancel` - Отменить текущее действие

## Для незарегистрированных пользователей

Бот проведет через диалог:
1. Спросит имя
2. Попросит телефон
3. Уточнит марку и модель авто
4. Попросит описать проблему
5. Создаст заявку в базе

## Для зарегистрированных пользователей

Чтобы пользователи могли быстро создавать заявки, нужно:
1. Добавить в личный кабинет кнопку "Привязать Telegram"
2. При клике показать код для бота
3. Пользователь отправляет код боту
4. Бот привязывает Telegram ID к аккаунту

После привязки заявки создаются в 1 клик - нужно только описать проблему.

## URL функции

Бот работает по адресу:
```
https://functions.poehali.dev/053f0a02-6a69-470d-8166-a03dbd9deb50
```

## Проверка webhook

Проверить статус можно командой:
```bash
curl "https://api.telegram.org/bot8020100875:AAEfiupni_EUkqQlWXtJv2vgCx0yL5i8-58/getWebhookInfo"
```

## Удаление webhook (если нужно)

```bash
curl "https://api.telegram.org/bot8020100875:AAEfiupni_EUkqQlWXtJv2vgCx0yL5i8-58/deleteWebhook"
```
